### -recommendation-_microservice_architecture

# Система Персонализированных Рекомендаций: Микросервисная Архитектура

## Описание Проекта

Этот проект представляет собой реализацию комплексной системы персонализированных рекомендаций, построенной на принципах микросервисной архитектуры. Целью проекта является демонстрация процесса генерации и выдачи рекомендаций в реальном времени, а также управления связанными данными и моделями. Система спроектирована для обеспечения масштабируемости, гибкости и возможности независимого развития каждого компонента.

Проект охватывает ключевые аспекты:
* Сбор и обработка пользовательских активностей.
* Хранение и доступ к real-time и оффлайн фичам.
* Генерация векторных представлений (эмбеддингов) товаров.
* Оркестрация процессов генерации кандидатов и ранжирования.
* Управление жизненным циклом ML-моделей.
* Проведение A/B-тестирования.
* Предоставление рекомендаций через API.

## Архитектура Системы (Микросервисы)

Архитектура системы основана на взаимодействии автономных микросервисов, каждый из которых отвечает за свою специфическую функциональность. Общая схема взаимодействия представлена на диаграмме контейнеров и BPMN-диаграмме.

* **Диаграмма контейнеров:** Показывает основные сервисы и их высокоуровневые взаимодействия.
* [Диаграмма С4 контекст](system_design/C4_context_rec.png)
* [Диаграмма С4 контейнеры](system_design/C4_container_rec.png)
* **BPMN-диаграмма:** Детализирует поток данных и логику при запросе рекомендаций.
* [BPMN диаграмма взаимодействия с рекомендациями пользователя](system_design/bpmn_user_flow_Level1.png)
* [BPMN диаграмма потока формирования рекомендаций](system_design/bpmn_recommendation_flow_Level2.png)
* **ER-диаграмма:** Визуализируют логическую модель хранения данных.
* [ER-диаграмма](system_design/erd_logical.png)

### Основные Компоненты Микросервисов:

1.  **`API Сервис Рекомендаций`**
    * **Роль:** Единая точка входа для всех запросов на рекомендации. Отвечает за прием запросов, валидацию, взаимодействие с кэшем и оркестратором, а также за выдачу финальных рекомендаций.
    * **API:** [Описан в `openapi`](recommendations-service/openapi.yaml)
    * **Взаимодействует с:** Оркестратором, Кэшем рекомендаций.

2.  **`Оркестратор`**
    * **Роль:** Координирует шаги по генерации кандидатов и их ранжированию. Принимает запрос от API-сервиса, вызывает Генератор кандидатов, затем Движок Моделей/Ранжирования.
    * **Хранилище:**  Данные запроса обрабатываются на лету и передаются между сервисами, пишутся в кэш.

3.  **`Генератор кандидатов`**
    * **Роль:** Формирует первоначальный, большой список товаров-кандидатов для пользователя. Использует фичи пользователя (real-time и оффлайн) и эмбеддинги товаров.
      
4.  **`Движок Моделей / Ранжирование`**
    * **Роль:** Применяет обученные ML-модели к списку кандидатов, полученных от Генератора, и ранжирует их, выдавая финальный отсортированный список рекомендаций.
    * **Взаимодействует с:** Регистром Моделей (для загрузки моделей), Кэшем рекомендаций (для записи результатов), Брокером сообщений (для логирования).

5.  **`Регистр Моделей`**
    * **Роль:** Хранит метаданные (версии, метрики, пути к артефактам) обученных ML-моделей. Позволяет `Движку Моделей / Ранжирование` загружать нужные версии моделей.
    * **База данных:** Реляционная БД (`ml_models`).

6.  **`Онлайн Real-Time Фичи`**
    * **Роль:** Предоставляет актуальные фичи пользователя и контекста (например, последние просмотренные товары, текущая сессия) с минимальной задержкой.
    * **База данных:** Key-Value хранилище (например, Redis) для высокой производительности.

7.  **`Оффлайн Фичи`**
    * **Роль:** Предоставляет агрегированные, предварительно рассчитанные исторические фичи пользователей и товаров. Данные обновляются пакетами.
    * **База данных:** Колоночная БД или распределенная NoSQL (например, ClickHouse).

8.  **`Эмбеддинг товаров`**
    * **Роль:** Хранит и предоставляет векторные представления (эмбеддинги) товаров для поиска похожих товаров или использования в моделях.
    * **База данных:** Векторная БД (например, Pinecone) или специализированный индекс.

9.  **`Модуль A/B Тестирования`**
    * **Роль:** Управляет проведением A/B экспериментов, назначает пользователей в тестовые группы и предоставляет информацию о принадлежности пользователя к группе.
    * **База данных:** Реляционная БД.

10. **`Сборщик Активностей / Сборщик Логов`**
    * **Роль:** Собирают сырые пользовательские события (клики, просмотры, покупки) и системные логи (выданные рекомендации, использованные модели) и отправляют их в Брокер сообщений.
    * **Хранилище:** Не имеют собственной постоянной БД.

11. **`Брокер сообщений (Kafka, симуляция)`**
    * **Роль:** Асинхронная передача событий между микросервисами и буферизация данных перед их обработкой и загрузкой в Data Lake/DWH.
    * **Технология:** Для портфолио будет симулироваться.

### Высокоуровневый Поток Данных (Запрос Рекомендаций)

1.  **Клиент (Маркетплейс)** делает запрос на рекомендации к **`API Сервису Рекомендаций`**.
2.  **`API Сервис`** проверяет **Кэш рекомендаций пользователя** (не показан на ERD, это чистый кэш).
3.  Если рекомендаций нет в кэше, **`API Сервис`** передает запрос **`Оркестратору`**.
4.  **`Оркестратор`** вызывает **`Генератор кандидатов`**.
5.  **`Генератор кандидатов`** получает данные из:
    * **`Онлайн Real-Time Фичи`** (актуальные данные пользователя/контекста).
    * **`Оффлайн Фичи`** (агрегированные исторические фичи).
    * **`Эмбеддинг товаров`** (векторные представления товаров).
6.  **`Генератор кандидатов`** формирует список потенциальных кандидатов и передает его **`Движку Моделей / Ранжирование`**.
7.  **`Движок Моделей / Ранжирование`** загружает нужную модель из **`Регистра Моделей`** и применяет её для ранжирования кандидатов.
8.  Финальный список рекомендаций кэшируется в **Кэш рекомендаций пользователя** и логируется в **`Брокер сообщений`**.
9.  **`Движок Моделей / Ранжирование`** возвращает список **`Оркестратору`**, который, в свою очередь, возвращает его **`API Сервису`**.
10. **`API Сервис`** возвращает рекомендации клиенту.

## Используемые Технологии

* **Python:** Основной язык для разработки микросервисов.
* **Redis:** Для `Онлайн Real-Time Фич` и кэширования.
* **PostgreSQL:** Для `Регистра Моделей` и `Модуля A/B Тестирования`.
* **Docker / Docker Compose:** Для контейнеризации и локального развертывания всех компонентов.
* **OpenAPI (Swagger):** Для спецификации и интерактивной документации API.
